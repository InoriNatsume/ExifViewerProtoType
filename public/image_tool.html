<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EXIF 뷰어 (표준/스텔스)</title>
  <!-- 브라우저 환경에서 CDN 로드 (GitHub Pages용) -->
  <script src="https://cdn.jsdelivr.net/npm/exifr/dist/full.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #eef1f7; color: #1d2433; margin: 0; padding: 0; }
    .container { max-width: 1180px; margin: 0 auto; padding: 24px; }
    h1 { text-align: center; margin-bottom: 10px; }
    .top-bar { display: grid; grid-template-columns: 2fr 1.2fr; gap: 16px; align-items: start; }
    .upload-box { border: 2px dashed #cdd4e0; padding: 20px; text-align: center; border-radius: 12px; background: #fff; cursor: pointer; }
    .upload-box.dragover { border-color: #304ffe; background: #f1f4ff; }
    .upload-box:hover { border-color: #94a8c5; }
    .preview { margin-top: 12px; text-align: center; }
    .preview img { max-width: 100%; max-height: 320px; display: none; border: 1px solid #e3e6ed; border-radius: 8px; }
    .meta { color: #444; font-size: 0.95rem; }
    .badges { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .badge { padding: 6px 10px; border-radius: 10px; font-size: 0.9rem; border: 1px solid #d7deea; background: #fff; }
    .badge.ok { background: #e6f7ed; color: #0a7a33; border-color: #b6e2c2; }
    .badge.none { background: #fff3e0; color: #b26a00; border-color: #ffd8a8; }
    .viewer-toggle { display: flex; gap: 8px; margin-top: 10px; }
    .viewer-btn { padding: 8px 12px; border: 1px solid #cdd4e0; background: #fff; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .viewer-btn.disabled { opacity: 0.5; cursor: not-allowed; }
    .src-toggle { display: flex; gap: 8px; margin-top: 8px; }
    .src-btn { padding: 8px 12px; border: 1px solid #cdd4e0; background: #fff; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .src-btn.active { background: #304ffe; color: #fff; border-color: #304ffe; }
    .src-btn.disabled { opacity: 0.5; cursor: not-allowed; }
    .panel { background: #fff; border: 1px solid #dce2ed; border-radius: 12px; padding: 14px; }
    .panel h3 { margin: 6px 0 10px; font-size: 1rem; }
    .tabs { display: flex; gap: 8px; margin-top: 20px; }
    .tab-btn { flex: 1; padding: 12px; border: 1px solid #cdd4e0; background: #fff; cursor: pointer; border-radius: 10px; font-weight: 600; }
    .tab-btn.active { background: #304ffe; color: #fff; border-color: #304ffe; }
    .tab-content { display: none; margin-top: 12px; background: #fff; border: 1px solid #cdd4e0; border-radius: 12px; padding: 16px; min-height: 260px; }
    .tab-content.active { display: block; }
    .section-grid { display: flex; flex-wrap: wrap; gap: 12px; }
    .section-card { border: 1px solid #e0e4ec; border-radius: 10px; padding: 10px 12px; background: #fff; }
    .section-card[data-mode="block"] { flex: 1 1 100%; }
    .section-card[data-mode="grid"] { flex: 1 1 48%; min-width: 420px; }
    .section-card h4 { margin: 4px 0 10px; font-size: 0.95rem; color: #2a3345; }
    .section-card[data-mode="grid"] .section-row { display: grid; grid-template-columns: 140px 1fr; gap: 10px; padding: 4px 0; }
    .section-card[data-mode="block"] .section-row { display: block; padding: 4px 0; }
    .section-row .label { font-weight: 700; color: #4a5568; }
    .section-row .value { margin: 4px 0 0; font-size: 0.95rem; white-space: pre-wrap; word-break: break-word; background: #f7f9fc; border-radius: 6px; padding: 8px; border: 1px solid #e3e7f1; }
    pre { white-space: pre-wrap; word-break: break-word; margin: 0; font-family: ui-monospace, SFMono-Regular, Consolas, monospace; }
    .raw-area { max-height: 360px; overflow: auto; border: 1px solid #e1e5ee; border-radius: 10px; padding: 10px; background: #f9fbff; }
    .actions { margin-top: 12px; text-align: right; }
    .primary { background: #304ffe; color: #fff; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .key-table { width: 100%; border-collapse: collapse; font-size: 0.93rem; }
    .key-table th, .key-table td { border: 1px solid #e1e6f0; padding: 6px 8px; vertical-align: top; }
    .key-table th { background: #f3f6fb; text-align: left; }
    .key-table td:nth-child(1) { width: 35%; word-break: break-all; }
    .key-table td:nth-child(2) { width: 10%; }
    .key-table td:nth-child(3) { word-break: break-word; }
    .key-explorer-layout { display: grid; grid-template-columns: minmax(220px, 320px) 1fr; gap: 12px; }
    .key-tree { border: 1px solid #e1e6f0; border-radius: 10px; padding: 10px; background: #f9fbff; max-height: 420px; overflow: auto; }
    .key-detail { border: 1px solid #e1e6f0; border-radius: 10px; padding: 10px; background: #fff; min-height: 320px; }
    .key-tabs { display: flex; gap: 6px; flex-wrap: wrap; }
    .key-tab { display: inline-flex; align-items: center; gap: 6px; background: #f3f6fb; border: 1px solid #d8e0ef; border-radius: 8px; padding: 4px 6px; }
    .key-tab-btn { border: none; background: transparent; cursor: pointer; font-size: 0.88rem; color: #2a3345; }
    .key-tab-btn.active { color: #304ffe; font-weight: 700; }
    .key-tab-close { border: none; background: transparent; cursor: pointer; font-size: 0.85rem; color: #667; }
    .key-tab-contents { margin-top: 10px; }
    .key-tab-content { display: none; }
    .key-tab-content.active { display: block; }
    .key-empty { color: #667085; font-size: 0.92rem; margin-top: 12px; }
    .key-node { margin: 4px 0; }
    .key-node summary { cursor: pointer; font-weight: 600; color: #2a3345; }
    .key-children { margin-left: 12px; border-left: 2px solid #eef2f8; padding-left: 8px; }
    .key-leaf { margin: 4px 0; padding: 4px 6px; border-radius: 6px; cursor: pointer; color: #2a3345; }
    .key-leaf:hover { background: #eef3ff; }
    .key-detail-table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
    .key-detail-table th, .key-detail-table td { border: 1px solid #e1e6f0; padding: 6px 8px; vertical-align: top; }
    .key-detail-table th { width: 90px; background: #f3f6fb; text-align: left; }
    .key-children-table { width: 100%; border-collapse: collapse; font-size: 0.93rem; }
    .key-children-table th, .key-children-table td { border: 1px solid #e1e6f0; padding: 6px 8px; vertical-align: top; }
    .key-children-table th { background: #f3f6fb; text-align: left; }
    .key-child-row { cursor: pointer; }
    .key-child-row:hover { background: #f7f9ff; }
    .mini-row { display: grid; grid-template-columns: 140px 1fr; gap: 6px; padding: 4px 0; }
    .mini-label { font-weight: 700; color: #4a5568; }
    .mini-value { background: #f7f9fc; border: 1px solid #e3e7f1; border-radius: 6px; padding: 6px 8px; }
    .mini-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 12px; margin-top: 12px; }
    @media (max-width: 980px) {
      .key-explorer-layout { grid-template-columns: 1fr; }
      .key-tree { max-height: 240px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>EXIF 뷰어 (표준/스텔스)</h1>
    <div class="top-bar">
      <div class="upload-box" id="upload-box" onclick="document.getElementById('fileInput').click()">
        <p>이미지 파일을 선택하거나 드래그하세요.</p>
        <input type="file" id="fileInput" accept="image/png,image/jpeg,image/webp" style="display:none" />
        <div class="preview">
          <img id="preview" alt="미리보기" />
          <div id="file-meta" class="meta"></div>
        </div>
      </div>
      <div class="panel">
        <h3>상태 & 액션</h3>
        <div class="badges">
          <span id="badge-model" class="badge">판정: 대기</span>
        </div>
        <div class="viewer-toggle">
          <button id="btn-open-comfy" class="viewer-btn disabled" disabled>ComfyUI 보기</button>
        </div>
        <div class="src-toggle">
          <button id="src-stealth" class="src-btn">스텔스 보기</button>
          <button id="src-standard" class="src-btn">표준 보기</button>
        </div>
        <div class="actions">
          <button id="btn-save-json" class="primary">JSON 저장</button>
        </div>
      </div>
    </div>

    <div class="mini-grid">
      <div class="section-card" data-mode="grid">
        <h4>샘플 설정</h4>
        <div id="mini-sample"></div>
      </div>
      <div class="section-card" data-mode="grid">
        <h4>크기/시드</h4>
        <div id="mini-size"></div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="normalized">정규화 뷰</button>
      <button class="tab-btn" data-tab="raw">RAW</button>
      <button class="tab-btn" data-tab="keys">필드 탐색</button>
    </div>

    <div id="tab-normalized" class="tab-content active">
      <div id="section-view" class="section-grid">정규화된 값이 없습니다.</div>
    </div>
    <div id="tab-raw" class="tab-content">
      <div class="raw-area"><pre id="raw-selected">선택된 EXIF 없음</pre></div>
    </div>
    <div id="tab-keys" class="tab-content">
      <div id="key-explorer">탐색 가능한 데이터가 없습니다.</div>
    </div>
  </div>

  <script type="module">
    import { initViewer } from '../src/ui/viewer.js';
    initViewer();
  </script>
</body>
</html>
